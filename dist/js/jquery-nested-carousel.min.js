!function(e){function n(n,t){this.$ele=n,this.options=e.extend({},e.fn[d].defaults,t),this.init()}function t(e){var n,t;return n=e.css("transform"),n.indexOf("(")>=0?(n=n.split("(")[1],n=n.split(")")[0],n=n.split(","),t=Number(n[4])):t=0,t}function i(e,n){var t;return function(i){var d=this,a=arguments,o=function(){t=null,n||i.apply(d,a)},s=n&&!t;clearTimeout(t),t=setTimeout(o,e),s&&i.apply(d,a)}}var d="nestedTimeline";n.prototype={init:function(){var n,t,i=this;i._buildTemplate(),i.$flattenedViewContainer=i.$ele.find(".flattened-view"),i.$nestedViewContainer=i.$ele.find(".nested-view"),i._setNameContainerWidth(),n=i.$nestedViewContainer.find(".list .outer-node.selected"),n.addClass("center"),n.addClass("highlighted-node"),t=n.find(".inner-node.selected"),i.totalContentWidth=0,i.$nestedViewContainer.find(".list > ol >li").each(function(){i.totalContentWidth=i.totalContentWidth+e(this).outerWidth()}),i.containerWidth=i.$ele.find(".list").outerWidth(),i.nodeMargin=2*i.$nestedViewContainer.find(".list > ol >li").css("margin-left").replace("px",""),i.listContainerWidth=i.totalContentWidth+i.nodeMargin*i.$nestedViewContainer.find(".list > ol >li").length-i.nodeMargin,i.$nestedViewContainer.find(".list .outer-nodes-container").css("width",i.listContainerWidth),i.end={left:!1,right:!1},i._attachEvents(),i._updateSlider(),i._updateNestedViewButtonState(),i.$ele.find('[data-toggle="popover"]').popover({trigger:"hover",container:"body",template:'<div class="nested-node-popover popover"><div class="arrow"></div><div class="popover-content"></div></div>'}),i.options.viewFlattened||i.$ele.find(".flattened-view").addClass("hidden"),i.options.viewNested||i.$ele.find(".nested-view").addClass("hidden")},_buildTemplate:function(){var n=this,t=e("<section class='nested-view'><div class='timeline'> <div class='list-wrapper'> <div class='list'></div></div></section>"),i=e("<section class='flattened-view'><div class='flattened-node'></div></section>"),d=e("<ol class='outer-nodes-container'></ol>");n.$ele.addClass("ns-horizontal-timeline"),n.options.data.forEach(function(n){var t=e("<ul class='inner-nodes-container'></ul>");n.list.forEach(function(d){var a=e("<a href='#0'></a>");a.data("content",d.name?d.name:n.name?n.name:"").attr("data-id",d.id),a.addClass("state-"+d.state),e("<li data-toggle='popover' title='Activity Name' data-placement='bottom' class='inner-node "+(d.selected?"selected":"")+"'></li>").data("content",d.name?d.name:n.name?n.name:"").attr("data-id",d.id).append(a).appendTo(t),d.selected&&i.find(".flattened-node").text(d.name)}),e("<li class='outer-node "+(n.selected?"selected":"")+"' data-id='"+n.id+"' data-name='"+n.name+"'><div class='outer-list-name'><p>"+n.name+"</p></div></li>").append(t).appendTo(d)}),t.find(".list").append(d),t.find(".timeline").append("<ul class='ns-timeline-navigation'> <li><a href='#0' class='prev' title='Previous'></a></li> <li><a href='#0' class='next' title='Next'></a></li></ul>"),t.appendTo(n.$ele),i.prepend("<ul class='ns-timeline-navigation'> <li class='prev-btn-item'><span class='glyphicon glyphicon-play prev' aria-hidden='true'></span></li> <li class='next-btn-item'><span class='glyphicon glyphicon-play next' aria-hidden='true'></span></li></ul>"),i.appendTo(n.$ele)},_clickInnerNodeHandler:function(e){var n,t=this,i=e.closest(".outer-node");t.$nestedViewContainer.find(".outer-node.selected .inner-node.selected").removeClass("selected"),i.hasClass("selected")||(i.addClass("highlighted-node"),t.$nestedViewContainer.find(".outer-node.selected").removeClass("selected"),i.addClass("selected")),t.$nestedViewContainer.find(".outer-node.center").removeClass("center"),i.addClass("center"),t._updateSlider(),n=e.data("content"),e.parent().addClass("selected"),"function"==typeof t.options.nodeSwitchCallback&&t.options.nodeSwitchCallback({id:t.$ele.find(".nested-view .outer-node.selected").data("id"),name:t.$ele.find(".nested-view .outer-node.selected").data("name"),nestedNode:{id:t.$ele.find(".nested-view .outer-node.selected .inner-node.selected a").data("id"),name:t.$ele.find(".nested-view .outer-node.selected .inner-node.selected a").data("content")}}),t.$flattenedViewContainer.find(".flattened-node").text(n),t._updateNestedViewButtonState(),t._updateFlattenedViewButtonState()},_attachEvents:function(){var n=this;n.leftEdge=-n.listContainerWidth+n.containerWidth/2+n.$nestedViewContainer.find("ol > li.outer-node").outerWidth()/2+n.nodeMargin/2+n.$nestedViewContainer.find(".list").offset().left,n.rightEdge=n.containerWidth-(n.containerWidth/2+n.$nestedViewContainer.find("ol > li.outer-node").outerWidth()/2+n.nodeMargin/2)+n.$nestedViewContainer.find(".list").offset().left,n.$nestedViewContainer.find(".ns-timeline-navigation a.prev").on("click",function(e){e.preventDefault(),n.$nestedViewContainer.find(".outer-node.center").prev().length&&(n.$ele.find(".outer-node.center").removeClass("center").prev().addClass("center"),n._updateSlider(),n._updateNestedViewButtonState())}),n.$nestedViewContainer.find(".ns-timeline-navigation a.next").on("click",function(e){e.preventDefault(),n.$nestedViewContainer.find(".outer-node.center").next().length&&(n.$nestedViewContainer.find(".outer-node.center").removeClass("center").next().addClass("center"),n._updateSlider(),n._updateNestedViewButtonState())});var t=!1,d={};n.$nestedViewContainer.find(".list ol.outer-nodes-container").on("mousedown",".outer-node",function(e){t=!1,d={x:e.clientX,y:e.clientY}}).on("mousemove",".outer-node",function(e){e.clientX===d.x&&e.clientY===d.y||(t=!0)}).on("mouseup",".outer-node",function(i){var d=t;t=!1,d||(e(i.target).parent().hasClass("inner-node")?n._clickInnerNodeHandler(e(i.target)):n._clickInnerNodeHandler(e(e(i.currentTarget).find(".inner-node a")[0])))}),n.$flattenedViewContainer.find(".ns-timeline-navigation .glyphicon.prev").on("click",function(){event.preventDefault(),n.$nestedViewContainer.find(".outer-node.selected .inner-node.selected").prev().length?n._clickInnerNodeHandler(n.$nestedViewContainer.find(".outer-node.selected .inner-node.selected").prev().find("a")):n.$nestedViewContainer.find(".outer-node.selected").prev().length&&n._clickInnerNodeHandler(n.$nestedViewContainer.find(".outer-node.selected").prev().find(".inner-node").last().find("a"))}),n.$flattenedViewContainer.find(".ns-timeline-navigation .glyphicon.next").on("click",function(){event.preventDefault(),n.$nestedViewContainer.find(".outer-node.selected .inner-node.selected").next().length?n._clickInnerNodeHandler(n.$nestedViewContainer.find(".outer-node.selected .inner-node.selected").next().find("a")):n.$nestedViewContainer.find(".outer-node.selected").next().length&&n._clickInnerNodeHandler(n.$nestedViewContainer.find(".outer-node.selected").next().find(".inner-node").first().find("a"))}),n._efficientDragging=i(250),n.$nestedViewContainer.find(".list ol.outer-nodes-container").draggable({axis:"x",containment:[n.leftEdge,0,n.rightEdge,0],drag:function(e,t){n._efficientDragging(function(){t.offset.left==n.leftEdge?(n.$nestedViewContainer.find(".outer-node.center").removeClass("center"),n.$nestedViewContainer.find(".outer-node").last().addClass("center"),n._updateNestedViewButtonState()):t.offset.left==n.rightEdge?(n.$nestedViewContainer.find(".outer-node.center").removeClass("center"),n.$nestedViewContainer.find(".outer-node").first().addClass("center"),n._updateNestedViewButtonState()):(n.$nestedViewContainer.find(".outer-node.center").removeClass("center"),n.$nestedViewContainer.find(".outer-node.selected").addClass("center"),n._updateNestedViewButtonState(!0))})}}),n.$nestedViewContainer.find(".list ol.outer-nodes-container").on("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",".outer-node.highlighted-node:not('.selected')",function(){e(this).removeClass("highlighted-node")}),e(window).on("resize",function(e){n.resize()})},_updateSlider:function(){var e,n,i,d,a=this;e=a.$nestedViewContainer.find(".list").offset().left+a.containerWidth/2-a.$nestedViewContainer.find("ol > li.center").outerWidth()/2,n=a.$nestedViewContainer.find("ol li.center").offset().left,d=e-n,i=t(a.$nestedViewContainer.find(".list ol")),a.$nestedViewContainer.find(".list .outer-nodes-container").css("transform","translate3d("+(i+d)+"px,0px,0px)")},_setNameContainerWidth:function(){var n=this,t=n.$nestedViewContainer.find(".list .outer-nodes-container .outer-node");t.each(function(){var n=0,t=e(this);t.find(".inner-node").each(function(){var t=e(this);n+=t.outerWidth()}),n>300?t.find(".outer-list-name").css("width",n):t.find(".outer-list-name").css("width",300)})},_updateNestedViewButtonState:function(e){var n,t,i=this;n=t=!1,i.$nestedViewContainer.find(".outer-node.center").next().length||e?i.$nestedViewContainer.find(".ns-timeline-navigation a.next").removeClass("inactive"):(i.$nestedViewContainer.find(".ns-timeline-navigation a.next").addClass("inactive"),t=!0),i.$nestedViewContainer.find(".outer-node.center").prev().length||e?i.$nestedViewContainer.find(".ns-timeline-navigation a.prev").removeClass("inactive"):(i.$nestedViewContainer.find(".ns-timeline-navigation a.prev").addClass("inactive"),n=!0),"function"!=typeof i.options.carouselStateChanged||n==i.end.left&&t==i.end.right||(i.options.carouselStateChanged(n,t),i.end={left:n,right:t})},_updateFlattenedViewButtonState:function(){var e=this;e.$nestedViewContainer.find(".outer-node.selected .inner-node.selected").next().length||e.$nestedViewContainer.find(".outer-node.selected").next().length?e.$flattenedViewContainer.find(".ns-timeline-navigation .glyphicon.next").removeClass("inactive"):e.$flattenedViewContainer.find(".ns-timeline-navigation .glyphicon.next").addClass("inactive"),e.$nestedViewContainer.find(".outer-node.selected .inner-node.selected").prev().length||e.$nestedViewContainer.find(".outer-node.selected").prev().length?e.$flattenedViewContainer.find(".ns-timeline-navigation .glyphicon.prev").removeClass("inactive"):e.$flattenedViewContainer.find(".ns-timeline-navigation .glyphicon.prev").addClass("inactive")},changeState:function(e){var n=this,t=n.$ele.find(".list a[data-id='"+e.id+"']");t.removeClass(function(e,n){return(n.match(/\bstate-\S+/g)||[]).join(" ")}),t.addClass("state-"+e.state)},resize:function(){var e=this;e.containerWidth=e.$ele.find(".list").outerWidth(),e._updateSlider(),e.leftEdge=-e.listContainerWidth+e.containerWidth/2+e.$nestedViewContainer.find("ol > li.outer-node").outerWidth()/2+e.nodeMargin/2+e.$nestedViewContainer.find(".list").offset().left,e.rightEdge=e.containerWidth-(e.containerWidth/2+e.$nestedViewContainer.find("ol > li.outer-node").outerWidth()/2+e.nodeMargin/2)+e.$nestedViewContainer.find(".list").offset().left,e.$nestedViewContainer.find(".list ol.outer-nodes-container").draggable("option","containment",[e.leftEdge,0,e.rightEdge,0])},destroy:function(){this.$ele.empty(),e.data(this.$ele,"plugin_"+d,null)},selectNode:function(e){var n=this;n._clickInnerNodeHandler(this.$ele.find(".outer-node[data-id = '"+e.id+"'] .inner-node a[data-id = '"+e.nestedNode.id+"']"))}},e.fn[d]=function(t){var i=arguments;if(void 0==t||"object"==typeof t)return this.each(function(){e.data(this,"plugin_"+d)||e.data(this,"plugin_"+d,new n(e(this),t))});if("string"==typeof t&&"_"!==t[0]&&"init"!==t){var a;return this.each(function(){var o=e.data(this,"plugin_"+d);o instanceof n&&"function"==typeof o[t]&&(a=o[t].apply(o,Array.prototype.slice.call(i,1)))}),void 0!==a?a:this}},e.fn[d].defaults={viewNested:!0,viewFlattened:!0}}(jQuery);