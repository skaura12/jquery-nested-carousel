!function(e){function t(t,n){this.$ele=t,this.options=e.extend({},e.fn[i].defaults,n),this.init()}function n(e){var t,n;return t=e.css("transform"),t.indexOf("(")>=0?(t=t.split("(")[1],t=t.split(")")[0],t=t.split(","),n=Number(t[4])):n=0,n}var i="nestedTimeline";t.prototype={init:function(){var t,n,i=this;i._buildTemplate(),"nested"===i.options.mode&&i._setNameContainerWidth(),i.$ele.find(".ns-horizontal-timeline").addClass(i.options.mode+"-mode"),t=i.$ele.find(".list .outer-node.selected"),n=t.find(".inner-node.selected"),t.find("div.active > p").text(n.find("a").data("content")),i.totalContentWidth=0,i.$ele.find(".list > ol >li").each(function(){i.totalContentWidth=i.totalContentWidth+e(this).outerWidth()}),i.containerWidth=i.$ele.find(".list").outerWidth(),i._attachEvents(),i._updateSlider()},_buildTemplate:function(){var t=this,n=e("<section class='nested-mode ns-horizontal-timeline'><div class='timeline'> <div class='list-wrapper'> <div class='list'></div></div></section>"),i=e("<ol class='outer-nodes-container'></ol>");t.options.data.forEach(function(t){var n=e("<ul class='inner-nodes-container'></ul>");t.list.forEach(function(t){var i=e("<a href='#0'></a>");i.data("content",t.name?t.name:"").attr("data-id",t.id),i.addClass("state-"+t.state),e("<li class='inner-node "+(t.selected?"selected":"")+"'></li>").append(i).appendTo(n)}),e("<li class='outer-node "+(t.selected?"selected":"")+"' data-id='"+t.id+"' data-name='"+t.name+"'><div class='outer-list-name'><p>"+t.name+"</p></div></li>").append(n).append("<div class='inner-selected-name active'><p></p></div>").appendTo(i)}),n.find(".list").append(i),n.find(".timeline").append("<ul class='ns-timeline-navigation'> <li><a href='#0' class='prev'>Prev</a></li> <li><a href='#0' class='next'>Next</a></li></ul>"),n.appendTo(t.$ele)},_attachEvents:function(){var t=this;t.$ele.find(".ns-timeline-navigation a.prev").on("click",function(e){e.preventDefault(),t.$ele.find(".outer-node.selected .inner-node.selected").prev().length?t.$ele.find(".outer-node.selected .inner-node.selected").prev().find("a").trigger("click"):t.$ele.find(".outer-node.selected").prev().length&&t.$ele.find(".outer-node.selected").prev().find(".inner-node").last().find("a").trigger("click")}),t.$ele.find(".ns-timeline-navigation a.next").on("click",function(e){e.preventDefault(),t.$ele.find(".outer-node.selected .inner-node.selected").next().length?t.$ele.find(".outer-node.selected .inner-node.selected").next().find("a").trigger("click"):t.$ele.find(".outer-node.selected").next().length&&t.$ele.find(".outer-node.selected").next().find(".inner-node").first().find("a").trigger("click")}),t.$ele.find(".list .outer-nodes-container").on("click",".outer-node:not('.selected')",function(t){e(e(t.currentTarget).find(".inner-node a")[0]).trigger("click")}),t.$ele.find(".list .inner-nodes-container").on("click","a",function(n){n.preventDefault();var i=e(n.target).closest(".outer-node");t.$ele.find(".outer-node.selected > div.active > p").text(""),t.$ele.find(".outer-node.selected .inner-node.selected").removeClass("selected"),i.hasClass("selected")||(t.$ele.find(".outer-node.selected").removeClass("selected"),i.addClass("selected"),"nested"===t.options.mode&&t._updateSlider()),i.find("div.active > p").text(e(n.target).parent().addClass("selected").end().data("content")),"flattened"!==t.options.mode||e(n.target).data("content").length||i.find("div.active > p").text(i.data("name")),t._updateNavigationButtonState(),"function"==typeof t.options.nodeSwitchCallback&&t.options.nodeSwitchCallback({id:t.$ele.find(".outer-node.selected").data("id"),name:t.$ele.find(".outer-node.selected").data("name"),nestedNode:{id:t.$ele.find(".outer-node.selected .inner-node.selected a").data("id"),name:t.$ele.find(".outer-node.selected .inner-node.selected a").data("content")}}),n.stopPropagation()}),e(window).on("resize",function(e){t.resize()})},_updateSlider:function(){var e,t,i,d,a=this;e=a.$ele.find(".list").offset().left+a.containerWidth/2-a.$ele.find("ol > li.selected").outerWidth()/2,t=a.$ele.find("ol li.selected").offset().left,d=e-t,i=n(a.$ele.find(".list ol")),a.$ele.find(".list .outer-nodes-container").css("transform","translate3d("+(i+d)+"px,0px,0px)")},_setNameContainerWidth:function(){var t=this,n=t.$ele.find(".list ol > li");n.each(function(){var t=0,n=e(this);n.find("ul > li").each(function(){var n=e(this);t+=n.outerWidth()}),t>200?(n.find(".outer-list-name").css("width",t),n.find(".inner-selected-name").css("width",t)):(n.find(".outer-list-name").css("width",200),n.find(".inner-selected-name").css("width",200))})},_resetNestedNameContainerWidth:function(){this.$ele.find(".list .inner-selected-name").css("width","100%")},_updateNavigationButtonState:function(){var e=this;e.$ele.find(".outer-node.selected .inner-node.selected").next().length||e.$ele.find(".outer-node.selected").next().length?e.$ele.find(".ns-timeline-navigation a.next").removeClass("inactive"):e.$ele.find(".ns-timeline-navigation a.next").addClass("inactive"),e.$ele.find(".outer-node.selected .inner-node.selected").prev().length||e.$ele.find(".outer-node.selected").prev().length?e.$ele.find(".ns-timeline-navigation a.prev").removeClass("inactive"):e.$ele.find(".ns-timeline-navigation a.prev").addClass("inactive")},changeState:function(e){var t=this,n=t.$ele.find(".list a[data-id='"+e.id+"']");n.removeClass(function(e,t){return(t.match(/\bstate-\S+/g)||[]).join(" ")}),n.addClass("state-"+e.state)},resize:function(){var e=this;e.containerWidth=e.$ele.find(".list").outerWidth(),"nested"===e.options.mode&&e._updateSlider()},destroy:function(){this.$ele.empty(),e.data(this.$ele,"plugin_"+i,null)},selectNode:function(e){this.$ele.find(".outer-node[data-id = '"+e.id+"'] .inner-node a[data-id = '"+e.nestedNode.id+"']").trigger("click")},switchMode:function(e){this.options.mode!=e&&("nested"===e?(this.options.mode=e,this._setNameContainerWidth(),this.$ele.find(".ns-horizontal-timeline").removeClass("nested-mode flattened-mode").addClass(e+"-mode"),this.$ele.find(".outer-node.selected .inner-selected-name > p").text(this.$ele.find(".outer-node.selected .inner-node.selected a").data("content")),this._updateSlider()):"flattened"===e&&(this.options.mode=e,this._resetNestedNameContainerWidth(),this.$ele.find(".ns-horizontal-timeline").removeClass("nested-mode flattened-mode").addClass(e+"-mode"),this.$ele.find(".outer-node.selected .inner-node.selected a").data("content").length||this.$ele.find(".outer-node.selected .inner-selected-name > p").text(this.$ele.find(".outer-node.selected").data("name"))))}},e.fn[i]=function(n){var d=arguments;if(void 0==n||"object"==typeof n)return this.each(function(){e.data(this,"plugin_"+i)||e.data(this,"plugin_"+i,new t(e(this),n))});if("string"==typeof n&&"_"!==n[0]&&"init"!==n){var a;return this.each(function(){var s=e.data(this,"plugin_"+i);s instanceof t&&"function"==typeof s[n]&&(a=s[n].apply(s,Array.prototype.slice.call(d,1)))}),void 0!==a?a:this}},e.fn[i].defaults={mode:"nested"}}(jQuery);