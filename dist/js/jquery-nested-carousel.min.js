!function(e){function n(n,t){this.$ele=n,this.options=e.extend({},e.fn[i].defaults,t),this.init()}function t(e){var n,t;return n=e.css("transform"),n.indexOf("(")>=0?(n=n.split("(")[1],n=n.split(")")[0],n=n.split(","),t=Number(n[4])):t=0,t}var i="nestedTimeline";n.prototype={init:function(){var n,t,i=this;i._buildTemplate(),i.$flattenedViewContainer=i.$ele.find(".flattened-view"),i.$nestedViewContainer=i.$ele.find(".nested-view"),i._setNameContainerWidth(),n=i.$nestedViewContainer.find(".list .outer-node.selected"),n.addClass("center"),t=n.find(".inner-node.selected"),n.find("div.active").attr("title",t.find("a").data("content")),n.find("div.active > p").text(t.find("a").data("content")),i.totalContentWidth=0,i.$nestedViewContainer.find(".list > ol >li").each(function(){i.totalContentWidth=i.totalContentWidth+e(this).outerWidth()}),i.containerWidth=i.$ele.find(".list").outerWidth(),i._attachEvents(),i._updateSlider()},_buildTemplate:function(){var n=this,t=e("<section class='nested-view'><div class='timeline'> <div class='list-wrapper'> <div class='list'></div></div></section>"),i=e("<section class='flattened-view'><div class='timeline'> <div class='list-wrapper'> <div class='list'></div></div></div></section>"),d=e("<ol class='outer-nodes-container'></ol>"),a=e("<ol class='outer-nodes-container'></ol>");n.$ele.addClass("ns-horizontal-timeline"),n.options.data.forEach(function(n){var t=e("<ul class='inner-nodes-container'></ul>"),s=e("<ul class='inner-nodes-container'></ul>");n.list.forEach(function(d){var a,o=e("<a href='#0'></a>");o.attr("title",d.name?d.name:n.name?n.name:""),o.data("content",d.name?d.name:"").attr("data-id",d.id),o.addClass("state-"+d.state),e("<li class='inner-node "+(d.selected?"selected":"")+"'></li>").append(o).appendTo(t),a=e("<li class='inner-node "+(d.selected?"selected":"")+"'></li>"),a.text(d.name?d.name:n.name?n.name:""),a.attr("title",d.name?d.name:n.name?n.name:""),a.data("content",d.name?d.name:n.name?n.name:"").attr("data-id",d.id),s.append(a),i.find(".nodes-container").append(a)}),e("<li class='outer-node "+(n.selected?"selected":"")+"' data-id='"+n.id+"' data-name='"+n.name+"'><div class='outer-list-name'><p>"+n.name+"</p></div></li>").append(t).append("<div class='inner-selected-name active'><p></p></div>").appendTo(d),e("<li class='outer-node "+(n.selected?"selected":"")+"' data-id='"+n.id+"' data-name='"+n.name+"'></li>").append(s).appendTo(a)}),t.find(".list").append(d),i.find(".list").append(a),t.find(".timeline").append("<ul class='ns-timeline-navigation'> <li><a href='#0' class='prev' title='Previous'>Prev</a></li> <li><a href='#0' class='next' title='Next'>Next</a></li></ul>"),t.appendTo(n.$ele),i.find(".timeline").append("<ul class='ns-timeline-navigation'> <li><a href='#0' class='prev' title='Previous'>Prev</a></li> <li><a href='#0' class='next' title='Next'>Next</a></li></ul>"),i.appendTo(n.$ele)},_attachEvents:function(){var n=this;n.$nestedViewContainer.find(".ns-timeline-navigation a.prev").on("click",function(e){e.preventDefault(),n.$nestedViewContainer.find(".outer-node.center").prev().length&&(n.$ele.find(".outer-node.center").removeClass("center").prev().addClass("center"),n._updateSlider())}),n.$nestedViewContainer.find(".ns-timeline-navigation a.next").on("click",function(e){e.preventDefault(),n.$nestedViewContainer.find(".outer-node.center").next().length&&(n.$nestedViewContainer.find(".outer-node.center").removeClass("center").next().addClass("center"),n._updateSlider())}),n.$nestedViewContainer.find(".list .outer-nodes-container").on("click",".outer-node:not('.selected')",function(n){e(e(n.currentTarget).find(".inner-node a")[0]).trigger("click")}),n.$nestedViewContainer.find(".list .inner-nodes-container").on("click","a",function(t){t.preventDefault();var i,d=e(t.target).closest(".outer-node");n.$nestedViewContainer.find(".outer-node.selected > div.active > p").text(""),n.$nestedViewContainer.find(".outer-node.selected .inner-node.selected").removeClass("selected"),d.hasClass("selected")||(n.$nestedViewContainer.find(".outer-node.selected").removeClass("selected"),d.addClass("selected")),d.hasClass("center")||(n.$nestedViewContainer.find(".outer-node.center").removeClass("center"),d.addClass("center"),n._updateSlider()),i=e(t.target).data("content"),e(t.target).parent().addClass("selected"),d.find("div.active").attr("title",i).find("p").text(i),n._updateNavigationButtonState(),"function"==typeof n.options.nodeSwitchCallback&&n.options.nodeSwitchCallback({id:n.$ele.find(".nested-view .outer-node.selected").data("id"),name:n.$ele.find(".nested-view .outer-node.selected").data("name"),nestedNode:{id:n.$ele.find(".nested-view .outer-node.selected .inner-node.selected a").data("id"),name:n.$ele.find(".nested-view .outer-node.selected .inner-node.selected a").data("content")}}),n.$flattenedViewContainer.find(".outer-node.selected").removeClass("selected").find(".inner-node.selected").removeClass("selected"),n.$flattenedViewContainer.find(".outer-node[data-id = '"+d.data("id")+"']").addClass("selected").find(".inner-node[data-id = '"+e(t.target).data("id")+"']").addClass("selected"),t.stopPropagation()}),n.$flattenedViewContainer.find(".ns-timeline-navigation a.prev").on("click",function(){event.preventDefault(),n.$nestedViewContainer.find(".outer-node.selected .inner-node.selected").prev().length?n.$nestedViewContainer.find(".outer-node.selected .inner-node.selected").prev().find("a").trigger("click"):n.$nestedViewContainer.find(".outer-node.selected").prev().length&&n.$nestedViewContainer.find(".outer-node.selected").prev().find(".inner-node").last().find("a").trigger("click")}),n.$flattenedViewContainer.find(".ns-timeline-navigation a.next").on("click",function(){event.preventDefault(),n.$nestedViewContainer.find(".outer-node.selected .inner-node.selected").next().length?n.$nestedViewContainer.find(".outer-node.selected .inner-node.selected").next().find("a").trigger("click"):n.$nestedViewContainer.find(".outer-node.selected").next().length&&n.$nestedViewContainer.find(".outer-node.selected").next().find(".inner-node").first().find("a").trigger("click")}),e(window).on("resize",function(e){n.resize()})},_updateSlider:function(){var e,n,i,d,a=this;e=a.$nestedViewContainer.find(".list").offset().left+a.containerWidth/2-a.$nestedViewContainer.find("ol > li.center").outerWidth()/2,n=a.$nestedViewContainer.find("ol li.center").offset().left,d=e-n,i=t(a.$nestedViewContainer.find(".list ol")),a.$nestedViewContainer.find(".list .outer-nodes-container").css("transform","translate3d("+(i+d)+"px,0px,0px)")},_setNameContainerWidth:function(){var n=this,t=n.$nestedViewContainer.find(".list .outer-nodes-container .outer-node");t.each(function(){var n=0,t=e(this);t.find(".inner-node").each(function(){var t=e(this);n+=t.outerWidth()}),n>300?(t.find(".outer-list-name").css("width",n),t.find(".inner-selected-name").css("width",n)):(t.find(".outer-list-name").css("width",300),t.find(".inner-selected-name").css("width",300))})},_resetNestedNameContainerWidth:function(){this.$nestedViewContainer.find(".list .inner-selected-name").css("width","100%")},_updateNavigationButtonState:function(){var e=this;e.$ele.find(".outer-node.selected .inner-node.selected").next().length||e.$ele.find(".outer-node.selected").next().length?e.$ele.find(".ns-timeline-navigation a.next").removeClass("inactive"):e.$ele.find(".ns-timeline-navigation a.next").addClass("inactive"),e.$ele.find(".outer-node.selected .inner-node.selected").prev().length||e.$ele.find(".outer-node.selected").prev().length?e.$ele.find(".ns-timeline-navigation a.prev").removeClass("inactive"):e.$ele.find(".ns-timeline-navigation a.prev").addClass("inactive")},changeState:function(e){var n=this,t=n.$ele.find(".list a[data-id='"+e.id+"']");t.removeClass(function(e,n){return(n.match(/\bstate-\S+/g)||[]).join(" ")}),t.addClass("state-"+e.state)},resize:function(){var e=this;e.containerWidth=e.$ele.find(".list").outerWidth(),"nested"===e.options.mode&&e._updateSlider()},destroy:function(){this.$ele.empty(),e.data(this.$ele,"plugin_"+i,null)},selectNode:function(e){this.$ele.find(".outer-node[data-id = '"+e.id+"'] .inner-node a[data-id = '"+e.nestedNode.id+"']").trigger("click")},switchMode:function(e){this.options.mode!=e&&("nested"===e?(this.options.mode=e,this._setNameContainerWidth(),this.$ele.find(".ns-horizontal-timeline").removeClass("nested-mode flattened-mode").addClass(e+"-mode"),this.$ele.find(".outer-node.selected .inner-selected-name > p").text(this.$ele.find(".outer-node.selected .inner-node.selected a").data("content")),this._updateSlider()):"flattened"===e&&(this.options.mode=e,this._resetNestedNameContainerWidth(),this.$ele.find(".ns-horizontal-timeline").removeClass("nested-mode flattened-mode").addClass(e+"-mode"),this.$ele.find(".outer-node.selected .inner-node.selected a").data("content").length||this.$ele.find(".outer-node.selected .inner-selected-name > p").text(this.$ele.find(".outer-node.selected").data("name"))))}},e.fn[i]=function(t){var d=arguments;if(void 0==t||"object"==typeof t)return this.each(function(){e.data(this,"plugin_"+i)||e.data(this,"plugin_"+i,new n(e(this),t))});if("string"==typeof t&&"_"!==t[0]&&"init"!==t){var a;return this.each(function(){var s=e.data(this,"plugin_"+i);s instanceof n&&"function"==typeof s[t]&&(a=s[t].apply(s,Array.prototype.slice.call(d,1)))}),void 0!==a?a:this}},e.fn[i].defaults={mode:"nested"}}(jQuery);